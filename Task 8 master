#define F_CPU 16000000UL // CPU frequency for _delay_ms()

#include <avr/io.h>
#include <util/delay.h>

void SPI_MasterInit(void)
{
    DDRB |= (1 << PB2) | (1 << PB3) | (1 << PB5); // Set PB2 (SS), PB3 (MOSI), PB5 (SCK) as output
    DDRB &= ~(1 << PB4);  // Set PB4 (MISO) as input

    PORTB |= (1 << PB2); // Set SS high (Slave not selected)

    SPCR = (1 << SPE) | (1 << MSTR) | (1 << SPR0); // Enable SPI, Master mode, SPI mode 0, SCK = F_CPU/16
}

void SPI_MasterTransmit(uint8_t data)
{
    PORTB &= ~(1 << PB2); // Pull SS low to select Slave

    SPDR = data; // Load data into SPI Data Register

    while (!(SPSR & (1 << SPIF))) // Wait for transmission to complete
        ;
    PORTB |= (1 << PB2); // Pull SS high to end transfer
}

int main(void)
{
    SPI_MasterInit(); // Initialize SPI Master

    uint8_t values[3] = {85, 170, 255}; // Values to send
    uint8_t i = 0;

    while (1)
    {
        SPI_MasterTransmit(values[i]); // Send current value

        i++; // Move to next value
        if (i >= 3)
            i = 0;
        _delay_ms(1000); // Wait 1 second
    }
}
